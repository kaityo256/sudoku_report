# 数独スパコン物語

## はじめに

2013年3月8日金曜日、arXivに一編の論文が掲載された。タイトルは「レプリカ交換モンテカルロで作成された数独の難問 (Difficult Sudoku Puzzles Created by Replica Exchange Monte Carlo Method)」。投稿者は、当時東京大学物性研究所に務めていた研究者、すなわち私であった。私はまだこの論文が人生を(悪い意味で)大きく変えることになろうととは想像だにしていなかった。

研究者は論文を書くと、それを査読論文誌に投稿する。そして、査読を経て、出版が許可され、その論文誌から出版されると、その論文が研究者の「業績」となる。しかし、分野にもよるが、査読には一般に数週間から数ヶ月ほどかかるため、研究者は事前にarXivと呼ばれるプレプリントサーバに論文をアップロードすることが多い。似たようなことを誰かがやっている時、自分の方が早く論文を書いたのに競争相手の査読が先に終わって先に出版されては困るので、とりあえずやったことを公開する、という動機もあるし、論文を投稿する前にプレプリントサーバにアップロードし、広く研究者の意見を聞いてから投稿先を決める、といった目的もある。先の論文は後者の意図でアップロードされた。

プレプリントサーバには、毎日世界中から多くの論文が投稿される。研究者は、自分に近い分野についてそれをチェックする。朝のプレプリントサーバのチェックから一日を始める研究者もいる。先の「数独論文」は、そんな研究者に発見され、Twitterで「数独の難問をスパコンで作成。東大物性研の研究者」といった内容で紹介された。これが著名な物理学者にリツィートされることで一気に広まった。「スパコンで数独の難問を作った」というニュースは瞬く間に拡散され、研究者以外の一般の数独愛好家にも届いた。そして「スパコンで作り、人の手ではまず解けないだろう」とされた問題が、あっというまに解けてしまう問題であることがわかり、今度は「スパコンで作った数独、人間にあっというまに解かれる」という「痛いニュース」として拡散され、「ねとらぼ」などの著名なメディアにも取り上げられた。所謂「炎上」状態であった。

なぜこういうことになったのか？何がいけなかったのか？そしてその後どうなったのか？

このリポジトリは、一連の数独騒動と、その後の数独プロジェクトについての記録である。

## 始まりと炎上と

「なんだこりゃ？」

2010年8月のある日、いつものように出勤し、ひとしきり仕事をして、昼食のために外に出ようとした私は、研究室の扉に一枚の紙が貼ってあることに気がついた。そこには「数学のエキスパートが3ヶ月かけて作成した「世界一難しい数独」というタイトルとともに、一つの数独の問題が描いてあった。当時同室だったTさんが貼ったものに違いない。しかも、部屋の「内側」に貼ってあったということは、これは私に向けた「解いてみろ」とのメッセージだ。

数独を自分の手で解いたことはほとんど無いが、プログラムで解いたことならあった。高校生の頃だったか、大学一年生の頃だったか、私は突然、情報処理技術者試験を受けようと思い立った。なぜそう思ったかは覚えていないが、とりあえず手始めにと書店にあった「合格情報処理」という雑誌を買って勉強した。その雑誌のコーナーの一つとして「数独」があった。私は勉強の合間に数独を解くプログラムを書いてみたのだった。おそらくこれが私と数独との初めての出会いであったと思う。要するに手で解くより先に、プログラムで解いたのだった。

「数学のエキスパートが作成した難問」を見た時も、手で解こうとは全く思わず、とりあえずRubyで解法プログラムを組んだ。実行すると答えはすぐに出た。おそらく10ミリ秒もかかっていない。私はその答えを問題の隣に貼り出し、満足して昼食にでかけたのだった。

そんなことがあったことなどしばらく忘れていたのだが、2013年になって、私が所属するプロジェクトで「レプリカ交換モンテカルロ法」の効率が話題となった。詳細は後述するが、これは東大の福島さんが考案した手法で、普通のモンテカルロ法に比べて非常に効率がよくなる手法だ。特にスパコンでの並列計算と相性が良いことから、HPC(High Performance Computing)分野で広く使われていた。しかし、これがどういう問題で、どういう時に効率がよくなるのか、当時の私はよくわかっていなかった。その時、突然3年前の「世界一難しい数独」のことを思い出した。

「スパコンでレプリカ交換モンテカルロ法を使えば、世界一難しい数独を作ることができるんじゃないだろうか？」

2013年当時、私は「京コンピュータ」の全ノード計算をするなど、それなりに大規模な計算を行っていた。それに伴い、気持ちも大きくなっていたのだろう。世界有数の計算機を使えるのだから、世界有数の「なにか」ができるに違いない。そんな考えが傲慢であったことを、私は後で痛いほど思い知ることになる。

私は数独の難易度を定義し、スパコンで難問を探索させた。そして、適当にやった場合は全く難問が見つからず、交換モンテカルロ法を用いた場合には効率よく難問が見つかることを確認した。満足した私は、その手法と結果を論文にまとめ、スパコンが見つけて来た「最も難しい問題」に「人間にはまず解けないだろう」という刺激的な説明をつけて、プレプリントサーバに投稿したのだった。

その後の騒動は前述の通りである。それまでもプチ炎上はあったが、ここまでの炎上は初めての経験である。よせば良いのにエゴサーチをして「評判」を調べた。私は「自分は心が強いほうだ」と思っているが、「アホか」「自分で解いてみなかったのか？」「東大暇そうだな」などのコメントが並ぶのを見て心が折れ、その日は職場を早退したのだった。

## 数独プロジェクト立ち上げ

家に帰り、嫁さんに心配されたが、一晩寝たらメンタルはほぼ回復した。繰り返しになるが、私は心が強い方だ。次の日から、自分の失敗原因を検討していた。いろいろまずかった点はあるが、最もまずかったのは「一人だった」ことだと結論した。仲間が必要だ。一緒に「世界一」を目指し、そしてなにか失敗シた時に「一緒に恥をかいてくれる」仲間が。

その時、僕の頭には一人の人物が浮かんでいた。未踏ユースプロジェクトで同期だったKさんだ。KさんはOSを自作するというテーマで未踏に採択された。未踏のブースト会議のプレゼンで、(GCCの吐いたコードではなく)GCCを改造するという話をしたのを明瞭に覚えていた。彼はその後会社に就職していたが、会社のブログで数独のプログラムを書いているのを見たことがあった。彼なら一緒にプロジェクトをやってくれるかもしれない。

私はエゴサーチしていた時に、私の論文に反応していたNさんに連絡をとった。Nさんも未踏の同期で、Kさんと同じ会社に勤めていた。こうしてNさんの紹介により、私はKさんを始めとする多くの人に出会い、「数独難問作成プロジェクト」を立ち上げることになった。2013年7月のことである。

(続く)